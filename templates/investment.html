{% extends "base.html" %}

{% block title %}Investment - Stock Monitoring System{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h1>ðŸ’° Investment Tracking</h1>
    <div style="display: flex; gap: 10px;">
        <a href="{{ url_for('add_investment') }}" class="btn btn-success">âž• Add Transaction</a>
        <a href="{{ url_for('dashboard') }}" class="btn">ðŸ“Š Back to Dashboard</a>
    </div>
</div>

<div class="card">
    <h2>Investment Summary</h2>
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">${{ "%.2f"|format(total_invested) }}</div>
            <div class="stat-label">Net Investment</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-value">${{ "%.2f"|format(stock_value) }}</div>
            <div class="stat-label">Current Stock Value</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-value">{{ items | length }}</div>
            <div class="stat-label">Different Items</div>
        </div>
    </div>
</div>

<div class="card">
    <h2>Investment Transactions</h2>
    {% if transactions %}
        <table>
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Amount</th>
                    <th>Investor</th>
                    <th>Contact</th>
                    <th>Description</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                {% for transaction in transactions %}
                <tr>
                    <td>
                        {% if transaction.transaction_type == 'invest' %}
                            <span style="color: #27ae60; font-weight: bold;">ðŸ’° Invest</span>
                        {% else %}
                            <span style="color: #e74c3c; font-weight: bold;">ðŸ’¸ Withdraw</span>
                        {% endif %}
                    </td>
                    <td style="font-weight: bold; color: {% if transaction.transaction_type == 'invest' %}#27ae60{% else %}#e74c3c{% endif %}">
                        {% if transaction.transaction_type == 'invest' %}+{% else %}-{% endif %}${{ "%.2f"|format(transaction.amount) }}
                    </td>
                    <td>
                        <strong>{{ transaction.investor_name }}</strong>
                        {% if transaction.investor_phone %}
                            <br><small style="color: #666;">ðŸ“ž {{ transaction.investor_phone }}</small>
                        {% endif %}
                    </td>
                    <td>
                        {% if transaction.investor_email %}
                            <a href="mailto:{{ transaction.investor_email }}" style="color: #667eea;">{{ transaction.investor_email }}</a>
                        {% else %}
                            <span style="color: #999;">No email</span>
                        {% endif %}
                    </td>
                    <td>{{ transaction.description }}</td>
                    <td>{{ transaction.created_at[:19].replace('T', ' ') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div style="text-align: center; padding: 40px;">
            <div style="font-size: 48px; margin-bottom: 20px;">ðŸ’°</div>
            <h3>No investment transactions yet</h3>
            <p style="color: #666;">Start tracking your investments and withdrawals.</p>
            <a href="{{ url_for('add_investment') }}" class="btn btn-success" style="margin-top: 20px;">âž• Add First Transaction</a>
        </div>
    {% endif %}
</div>

<div class="card">
    <h2>Current Stock Inventory Value</h2>
    {% if items %}
        <table>
            <thead>
                <tr>
                    <th>Item Name</th>
                    <th>Quantity</th>
                    <th>Selling Price</th>
                    <th>Total Value</th>
                    <th>Percentage of Total Stock Value</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td><strong>{{ item.name }}</strong></td>
                    <td>{{ item.quantity }}</td>
                    <td>${{ "%.2f"|format(item.selling_price) }}</td>
                    <td style="font-weight: bold; color: #667eea;">${{ "%.2f"|format(item.current_stock_value) }}</td>
                    <td>
                        {% set percentage = (item.current_stock_value / stock_value * 100) if stock_value > 0 else 0 %}
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="flex: 1; background-color: #e0e0e0; border-radius: 10px; height: 20px; overflow: hidden;">
                                <div style="background-color: #667eea; height: 100%; width: {{ percentage }}%; transition: width 0.3s;"></div>
                            </div>
                            <span style="min-width: 50px; text-align: right;">{{ "%.1f"|format(percentage) }}%</span>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p style="text-align: center; color: #666;">No items in inventory.</p>
    {% endif %}
</div>
{% endblock %}
